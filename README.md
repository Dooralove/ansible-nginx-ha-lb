---

# ğŸš€ Ansible Nginx High Availability Load Balancer

![Ansible](https://img.shields.io/badge/Ansible-2.18-red) ![Nginx](https://img.shields.io/badge/Nginx-1.23-blue) ![HA](https://img.shields.io/badge/HA-LoadBalancer-green) ![Ubuntu](https://img.shields.io/badge/OS-Ubuntu-orange)

---

## ğŸ“Œ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ **Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ (HA Load Balancer) Ğ½Ğ° Nginx** Ñ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ Ğ¿ÑƒĞ»Ğ¾Ğ¼ Ğ±ÑĞºĞµĞ½Ğ´Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· **Ansible**.

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**

* ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Nginx Ğ½Ğ° LB Ğ¸ backend.
* Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ upstream Ğ¿ÑƒĞ»Ğ° Ğ¸Ğ· Ansible inventory.
* Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Nginx (`nginx -t`) Ğ¿ĞµÑ€ĞµĞ´ reload.
* Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸ĞµĞ¼ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ backend ÑĞµÑ€Ğ²ĞµÑ€Ğ°.
* Ğ›ĞµĞ³ĞºĞ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ Ñ€Ğ¾Ğ»ĞµĞ²Ñ‹Ğ¼Ğ¸ playbookâ€™Ğ°Ğ¼Ğ¸.

---

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```text
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚     Clients         â”‚
                           â”‚  (Web Browsers /    â”‚
                           â”‚   curl / Postman)   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ HTTP Requests
                                     â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚    LB Server        â”‚
                           â”‚   Nginx LoadBalancerâ”‚
                           â”‚   - Listen: 80      â”‚
                           â”‚   - Upstream Pool   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ Proxied Requests
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                      â–¼                       â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Backend 1     â”‚       â”‚ Backend 2     â”‚  ...  â”‚ Backend N     â”‚
     â”‚ Nginx App     â”‚       â”‚ Nginx App     â”‚       â”‚ Nginx App     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```text
ansible-nginx-ha-lb/
â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ hosts.txt            # LB Ğ¸ backend ÑĞµÑ€Ğ²ĞµÑ€Ñ‹
â”œâ”€â”€ playbooks/
â”‚   â””â”€â”€ site.yml             # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ playbook
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ lb/                  # Ğ Ğ¾Ğ»ÑŒ Load Balancer
â”‚   â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”‚   â””â”€â”€ configure.yml
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â”œâ”€â”€ lb.conf.j2
â”‚   â”‚       â””â”€â”€ upstream_backends.j2
â”‚   â””â”€â”€ backend/             # Ğ Ğ¾Ğ»ÑŒ backend ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²
â”‚       â””â”€â”€ tasks/main.yml
â””â”€â”€ README.md
```

---

## âš™ Ğ Ğ¾Ğ»Ğ¸ Ansible

### `lb` â€” Load Balancer

* Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Nginx.
* Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:

  * `lb.conf.j2` â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ LB.
  * `upstream_backends.j2` â€” Ğ¿ÑƒĞ» backend-ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ².
* Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´ reload.
* Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğ¹ ÑĞ°Ğ¹Ñ‚ Debian/Ubuntu.

### `backend` â€” Backend Servers

* Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Nginx.
* ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ°.
* ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚Ğ° 80.

---

---

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```bash
git clone <repo-url>
cd ansible-nginx-ha-lb
ansible-playbook -i ./inventory/hosts.txt playbooks/site.yml
```

> Playbook ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Nginx Ğ½Ğ° LB Ğ¸ backend, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ reload.

---

## ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ LB (Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° backend):

```bash
curl -sv http://<LB_IP>/
```

2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ² LB:

```bash
sudo tail -f /var/log/nginx/lb_access.log
```

* Ğ’ Ğ»Ğ¾Ğ³Ğ°Ñ… ÑƒĞ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ: `upstream: "10.0.2.15:80"` Ğ¸Ğ»Ğ¸ `"10.0.2.16:80"` â€” Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚, Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚.

3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° upstream Nginx:

```bash
sudo nginx -T | grep upstream -A 5
```

---

## ğŸ’¡ Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

* ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ **health checks** Ğ´Ğ»Ñ backend.
* Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ **SSL (HTTPS)** Ğ½Ğ° LB.
* Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ **sticky sessions**.
* ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° **RedHat/CentOS**.

---

## ğŸ”§ ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Nginx
sudo nginx -t

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Nginx
sudo systemctl reload nginx

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² LB
sudo tail -f /var/log/nginx/lb_access.log
```

---

